# Ananas Build Toolkit 2.0

## Bundled modules

- application
- scp (upload)
- webpack (install, build)
- docker (build, upload, deploy)

## Nouveautés

- revamped directory structure (etc/modules, etc/profiles)
- Concentré sur le build

## Stages

- build : builds project (ORM generation, assets compilation, etc)
- configure : configures sources
- deploy : deploys local sources to remote servers
- init : makes project compatible with the Ananas Build Toolkit
- install : installs dependencies (composer, npm, etc)
- package : creates build archive (phar, tar, etc)
- upload : uploads package to artifact repository

## Formalisme de nommage des propriété de module services

service.${servicetype}.${serviceinstance}.property

eg. :
- service.mysql.master.host
- service.elasticsearch.1.port
- service.rabbitmq.1.user

## TODO

- []  [anananas      ] renommer le projet en constructions-incongrues/anananas : dépôt, doc, composer.json, sammy, packagist
- []  [configuration ] implémenter une tâche de suppression des fichiers générés par `configuration.apply` appelée `configuration.reset`
- []  [configuration ] implémenter une tâche permettant d'ajouter les pendants des fichiers dist à .gitignore appelée `configuration.ignore`
- []  [configuration ] la tâche `configuration.update` ne doit pas déréférencer les substitutions dans le profil de configuration
- []  [configuration ] la tâche `configuration.dotenv` devrait exporter all.properties et pas seulement les valeurs présentes dans profil de configuration
- []  [doc           ] écrire un tutoriel pour créer un projet Symfony et le faire fonctionner avec Docker
- []  [toolkit       ] il faut descendre le chargement des propriétés du profil (pour profiter des valeurs des modules mandatory) => mais du coup ça pose un problème avec `application.domain=local`
- []  [toolkit       ] toolkit.module.enable => http://ant.apache.org/manual/Tasks/propertyfile.html
- []  [wrapper       ] anananas shell code crashes when executed by `/bin/sh` => détecter le shell et désactiver la coloration pour les shells incompatibles
- [x] [dotenv        ] il faut effectuer la substitution avant de transformer les nom de variables en shell compliant
- [x] [dotenv        ] soucis avec les lignes blanches dans les profils de configuration (=> =undefined)
- [x] [wrapper       ] écrire un wrapper `anananas`
