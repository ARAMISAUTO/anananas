<?xml version="1.0" encoding="UTF-8"?>
<project name="misc">

	<target name="help" description="Displays project's help">
		<java classname="org.apache.tools.ant.Main">
			<arg value="-buildfile" />
			<arg value="${ant.file}" />
			<arg value="-projecthelp" />
		</java>
	</target>

	<target name="configure" description="Configure a project for an exploitation environment" depends="setprofile">
		<exec executable="${basedir}/opt/ananas-build-toolkit/vendor/phpreprocessor/bin/phpreprocessor">
			<arg line="--command=apply
             --src=${source}
             --properties=${basedir}/etc/${profile}/build.properties" />
		</exec>
	</target>

	<!-- This target depends on several targets to make sure that one does not send a wrongly configured project to some env -->
	<target name="sync" description="(R)Sync your project files to a remote destination" depends="configure">
		<fail unless="profile" />
		<exec executable="rsync">
			<arg line="--cvs-exclude 
              --exclude-from=${basedir}/etc/${profile}/rsync.exclude
              --links
	      ${rsync.options}
              -agpvzc ${source}/ -e ssh ${remote.username}@${remote.host}:${remote.path.root}" />
		</exec>
	</target>

	<target name="orm" description="Generates ORM classes needed for the project to work properly">
		<exec executable="${source}/symfony">
			<arg line="doctrine:build --all-classes" />
		</exec>
	</target>
	
	<target name="deploy" description="Deploys latest changes to environment defined by profile" depends="liquibase.migrate,sync">
	</target>
	
	<target name="init" description="Inits empty project">
		<!-- Create directories -->
		<mkdir dir="${basedir}/src" />
		<mkdir dir="${basedir}/etc/liquibase/changelogs/" />
		
		<!-- Create sample profile -->
		<copy todir="${basedir}/etc/reference">
			<fileset dir="${basedir}/opt/ananas-build-toolkit/templates/profile/" includes="**/*" />
		</copy>
		
		<!-- Create project build.xml file -->
		<copy todir="${basedir}" file="${basedir}/opt/ananas-build-toolkit/templates/build.xml" />
	</target>
</project>
