<?xml version="1.0" encoding="UTF-8"?>
<project name="toolkit.helpers" default="help">
	<!-- Generates list of paths to module.xml files in toolkit.modules.paths property -->
	<scriptdef name="expandModulesPaths" language="javascript">
		<attribute name="native" />
        <attribute name="external" />
<![CDATA[
var modulesPaths = [];
var propertiesPaths = [];

// Generate paths for native modules
var modules = attributes.get('native').split(',');
for (var i = 0; i < modules.length; i++) {
    modulesPaths.push('vendor/constructions-incongrues/ananas-build-toolkit/modules/'+modules[i]+'/module.xml');
	propertiesPaths.push('vendor/constructions-incongrues/ananas-build-toolkit/modules/'+modules[i]+'/build.properties');
}

// Generate paths for external modules
var modules = attributes.get('external').split(',');
for (var i = 0; i < modules.length; i++) {
    modulesPaths.push(modules[i]+'/module.xml');
    propertiesPaths.push(modules[i]+'/build.properties');
}

modulesPaths = modulesPaths.join(',');
project.setNewProperty('toolkit.modules.paths', modulesPaths);
project.setNewProperty('toolkit.modules.paths.properties', propertiesPaths);
]]>
	</scriptdef>

	<!-- Iterates of project files and calls given target -->
    <macrodef name="iterate">
        <attribute name="target" />
        <attribute name="basedir" />
        <attribute name="paths" />
        <sequential>
            <subant target="@{target}" inheritall="true">
                <fileset dir="@{basedir}" includes="@{paths}" />
            </subant>
        </sequential>
    </macrodef>
</project>